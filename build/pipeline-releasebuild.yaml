
# Release builds are only manually triggered.
trigger: none
pr: none

# Create a daily midnight build for release builds on master to ensure our release builds function
schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - master
  always: true

variables:
  BuildPlatform: 'any cpu'
  BuildConfiguration: 'release'
  #intended for running all ui automation tests as one to reduce time
  ConsolidateAppCenterTests: true

#BUILD PHASE 
stages:
- stage: MSALBuildAndTest
  jobs: #Build and stage projects

  - template: template-build-and-run-all-tests.yaml
    parameters:
      DataFileDirectory: 'Release'

    # Pack and sign packages
  - job: 'PackAndSign'
    dependsOn:
    - 'BuildAndStageProjects'
    pool:
      vmImage: 'windows-latest'
      demands:
      - msbuild
      - visualstudio

    steps:
    - template: template-pack-and-sign-packages.yaml